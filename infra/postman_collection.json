{
	"info": {
		"_postman_id": "invoice-automation-api",
		"name": "Invoice Processing API",
		"description": "Complete API collection for Invoice Processing Automation system.\n\nIncludes:\n- Health check endpoint\n- Invoice extraction (Azure Document Intelligence)\n- Invoice validation (business rules + event publishing)\n- End-to-end processing\n\nSetup:\n1. Import this collection into Postman\n2. Configure environment variables (see Variables tab)\n3. Run requests in order for best results\n\nDocumentation: https://github.com/ammons-datalabs/adl-m365-automation-starter",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Health Check",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has status field\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('status');",
							"    pm.expect(jsonData.status).to.eql('ok');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "{{base_url}}/health",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"health"
					]
				},
				"description": "Health check endpoint to verify API is running.\n\nReturns:\n- status: \"healthy\"\n- timestamp: Current server time"
			},
			"response": [
				{
					"name": "Healthy Response",
					"originalRequest": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "http://localhost:8000/health",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"health"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"status\": \"ok\"\n}"
				}
			]
		},
		{
			"name": "Extract Invoice",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has extraction fields\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('vendor');",
							"    pm.expect(jsonData).to.have.property('total');",
							"    pm.expect(jsonData).to.have.property('confidence');",
							"});",
							"",
							"// Save extracted data for validation request",
							"if (pm.response.code === 200) {",
							"    var data = pm.response.json();",
							"    pm.environment.set('extracted_vendor', data.vendor);",
							"    pm.environment.set('extracted_total', data.total);",
							"    pm.environment.set('extracted_confidence', data.confidence);",
							"    pm.environment.set('extracted_content', data.full_content);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/pdf",
						"type": "text"
					}
				],
				"body": {
					"mode": "file",
					"file": {
						"src": "samples/invoice_sample.pdf"
					}
				},
				"url": {
					"raw": "{{base_url}}/invoices/extract",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"extract"
					]
				},
				"description": "Extract invoice fields using Azure Document Intelligence.\n\nInput: PDF or image file (raw binary)\nOutput: Vendor, total, invoice number, date, confidence, bill-to, full content\n\nNote: Replace the file path in Body > Binary with your actual invoice PDF."
			},
			"response": [
				{
					"name": "Successful Extraction",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/pdf"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "http://localhost:8000/invoices/extract",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"extract"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"vendor\": \"ACME Corporation\",\n    \"invoice_number\": \"INV-2025-001\",\n    \"invoice_date\": \"2025-10-15\",\n    \"total\": 450.00,\n    \"currency\": \"USD\",\n    \"confidence\": 0.92,\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"full_content\": \"ACME Corporation\\nInvoice #INV-2025-001\\nDate: October 15, 2025\\nBill To: My Company Pty Ltd\\n\\nDescription: Professional services\\nAmount: $450.00\\n\\nPlease remit payment within 30 days.\"\n}"
				}
			]
		},
		{
			"name": "Validate Invoice - Auto Approved",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Invoice is approved\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.approved).to.eql(true);",
							"});",
							"",
							"pm.test(\"All checks passed\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.checks.amount_within_limit).to.eql(true);",
							"    pm.expect(jsonData.checks.confidence_sufficient).to.eql(true);",
							"    pm.expect(jsonData.checks.document_type_is_invoice).to.eql(true);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				},
				"body": {
					"mode": "raw",
					"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-001\\nDate: October 15, 2025\\nBill To: My Company Pty Ltd\\n\\nDescription: Professional services\\nAmount: $450.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\", \"Acme Corporation\"]\n}"
				},
				"url": {
					"raw": "{{base_url}}/invoices/validate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"validate"
					]
				},
				"description": "Validate invoice against business rules (auto-approved scenario).\n\nThis example passes all checks:\n- Amount: $450 (below $500 threshold)\n- Confidence: 92% (above 85% minimum)\n- Document type: Invoice (payment obligation detected)\n- Bill-to: Authorized company\n\nResult: Auto-approved"
			},
			"response": [
				{
					"name": "Auto-Approved",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-001\\nDate: October 15, 2025\\nBill To: My Company Pty Ltd\\n\\nDescription: Professional services\\nAmount: $450.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\", \"Acme Corporation\"]\n}"
						},
						"url": {
							"raw": "http://localhost:8000/invoices/validate",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"validate"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"approved\": true,\n    \"reason\": \"Auto-approved: $450.00, 92.0% confidence\",\n    \"checks\": {\n        \"amount_within_threshold\": true,\n        \"confidence_sufficient\": true,\n        \"is_invoice\": true,\n        \"is_not_receipt\": true,\n        \"bill_to_authorized\": true\n    },\n    \"amount\": 450.00,\n    \"threshold\": 500.00,\n    \"confidence\": 0.92,\n    \"min_confidence\": 0.85\n}"
				}
			]
		},
		{
			"name": "Validate Invoice - Amount Exceeds Threshold",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Invoice is not approved\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.approved).to.eql(false);",
							"});",
							"",
							"pm.test(\"Amount check failed\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.checks.amount_within_limit).to.eql(false);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"amount\": 1250.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-002\\nDate: October 20, 2025\\nBill To: My Company Pty Ltd\\n\\nDescription: Consulting services\\nAmount: $1,250.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\"]\n}"
				},
				"url": {
					"raw": "{{base_url}}/invoices/validate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"validate"
					]
				},
				"description": "Validate invoice that exceeds amount threshold.\n\nThis example:\n- Amount: $1,250 (exceeds $500 threshold)\n- Confidence: 92% (sufficient)\n- Document type: Invoice\n- Bill-to: Authorized\n\nResult: Rejected (manual review required)"
			},
			"response": [
				{
					"name": "Manual Review Required",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 1250.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-002\\nDate: October 20, 2025\\nBill To: My Company Pty Ltd\\n\\nDescription: Consulting services\\nAmount: $1,250.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\"]\n}"
						},
						"url": {
							"raw": "http://localhost:8000/invoices/validate",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"validate"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"approved\": false,\n    \"reason\": \"Manual review required: amount exceeds $500 threshold\",\n    \"checks\": {\n        \"amount_within_threshold\": false,\n        \"confidence_sufficient\": true,\n        \"is_invoice\": true,\n        \"is_not_receipt\": true,\n        \"bill_to_authorized\": true\n    },\n    \"amount\": 1250.00,\n    \"threshold\": 500.00,\n    \"confidence\": 0.92,\n    \"min_confidence\": 0.85\n}"
				}
			]
		},
		{
			"name": "Validate Invoice - Receipt Detected",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Invoice is not approved\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.approved).to.eql(false);",
							"});",
							"",
							"pm.test(\"Receipt detected\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.checks.document_type_not_receipt).to.eql(false);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				},
				"body": {
					"mode": "raw",
					"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nReceipt #RCP-2025-001\\nDate: October 15, 2025\\n\\nPayment Received: $450.00\\nThank you for your payment!\\nCard ending in 4242\\nAuthorization code: 123456\\n\\nBalance: $0.00\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\"]\n}"
				},
				"url": {
					"raw": "{{base_url}}/invoices/validate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"validate"
					]
				},
				"description": "Validate document that is a receipt (payment confirmation) not an invoice.\n\nReceipt indicators detected:\n- \"Payment Received\"\n- \"Thank you for your payment\"\n- Card details\n- Balance: $0.00\n\nResult: Rejected (not a valid invoice)"
			},
			"response": [
				{
					"name": "Receipt Rejected",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nReceipt #RCP-2025-001\\nDate: October 15, 2025\\n\\nPayment Received: $450.00\\nThank you for your payment!\\nCard ending in 4242\\nAuthorization code: 123456\\n\\nBalance: $0.00\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"My Company Pty Ltd\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\"]\n}"
						},
						"url": {
							"raw": "http://localhost:8000/invoices/validate",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"validate"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"approved\": false,\n    \"reason\": \"Rejected: document appears to be a receipt (payment confirmation), not an invoice\",\n    \"checks\": {\n        \"amount_within_threshold\": true,\n        \"confidence_sufficient\": true,\n        \"is_invoice\": false,\n        \"is_not_receipt\": false,\n        \"bill_to_authorized\": true\n    },\n    \"amount\": 450.00,\n    \"threshold\": 500.00,\n    \"confidence\": 0.92,\n    \"min_confidence\": 0.85\n}"
				}
			]
		},
		{
			"name": "Validate Invoice - Unauthorized Bill-To",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Invoice is not approved\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.approved).to.eql(false);",
							"});",
							"",
							"pm.test(\"Bill-to check failed\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData.checks.bill_to_authorized).to.eql(false);",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json",
						"type": "text"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-003\\nDate: October 22, 2025\\nBill To: Different Company Inc\\n\\nDescription: Professional services\\nAmount: $450.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"Different Company Inc\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\", \"Acme Corporation\"]\n}"
				},
				"url": {
					"raw": "{{base_url}}/invoices/validate",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"validate"
					]
				},
				"description": "Validate invoice addressed to unauthorized company (fraud prevention).\n\nThis example:\n- Bill-to: \"Different Company Inc\" (not in authorized list)\n- All other checks pass\n\nResult: Rejected (unauthorized recipient)"
			},
			"response": [
				{
					"name": "Unauthorized Bill-To",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/json"
							}
						],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"amount\": 450.00,\n    \"confidence\": 0.92,\n    \"content\": \"ACME Corporation\\nInvoice #INV-2025-003\\nDate: October 22, 2025\\nBill To: Different Company Inc\\n\\nDescription: Professional services\\nAmount: $450.00\\n\\nPlease remit payment within 30 days.\",\n    \"vendor\": \"ACME Corporation\",\n    \"bill_to\": \"Different Company Inc\",\n    \"bill_to_authorized\": [\"My Company Pty Ltd\", \"Acme Corporation\"]\n}"
						},
						"url": {
							"raw": "http://localhost:8000/invoices/validate",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"validate"
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"approved\": false,\n    \"reason\": \"Rejected: invoice addressed to unauthorized company 'Different Company Inc'\",\n    \"checks\": {\n        \"amount_within_threshold\": true,\n        \"confidence_sufficient\": true,\n        \"is_invoice\": true,\n        \"is_not_receipt\": true,\n        \"bill_to_authorized\": false\n    },\n    \"amount\": 450.00,\n    \"threshold\": 500.00,\n    \"confidence\": 0.92,\n    \"min_confidence\": 0.85\n}"
				}
			]
		},
		{
			"name": "Process Invoice (End-to-End)",
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"pm.test(\"Status code is 200\", function () {",
							"    pm.response.to.have.status(200);",
							"});",
							"",
							"pm.test(\"Response has approval_id\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('approval_id');",
							"});",
							"",
							"pm.test(\"Response has decision\", function () {",
							"    var jsonData = pm.response.json();",
							"    pm.expect(jsonData).to.have.property('approved');",
							"});"
						],
						"type": "text/javascript"
					}
				}
			],
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/pdf",
						"type": "text"
					}
				],
				"body": {
					"mode": "file",
					"file": {
						"src": "samples/invoice_sample.pdf"
					}
				},
				"url": {
					"raw": "{{base_url}}/invoices/process?confidence_threshold=0.85",
					"host": [
						"{{base_url}}"
					],
					"path": [
						"invoices",
						"process"
					],
					"query": [
						{
							"key": "confidence_threshold",
							"value": "0.85"
						}
					]
				},
				"description": "End-to-end invoice processing (extract + validate + notify).\n\nSingle API call that:\n1. Extracts invoice fields via Azure Document Intelligence\n2. Validates against business rules\n3. Publishes event to Service Bus\n4. Stores approval decision\n5. Sends Teams notification (if configured)\n\nNote: Replace file path with your invoice PDF."
			},
			"response": [
				{
					"name": "Processed Successfully",
					"originalRequest": {
						"method": "POST",
						"header": [
							{
								"key": "Content-Type",
								"value": "application/pdf"
							}
						],
						"body": {
							"mode": "file",
							"file": {}
						},
						"url": {
							"raw": "http://localhost:8000/invoices/process?confidence_threshold=0.85",
							"protocol": "http",
							"host": [
								"localhost"
							],
							"port": "8000",
							"path": [
								"invoices",
								"process"
							],
							"query": [
								{
									"key": "confidence_threshold",
									"value": "0.85"
								}
							]
						}
					},
					"status": "OK",
					"code": 200,
					"_postman_previewlanguage": "json",
					"header": [
						{
							"key": "Content-Type",
							"value": "application/json"
						}
					],
					"cookie": [],
					"body": "{\n    \"approval_id\": \"550e8400-e29b-41d4-a716-446655440000\",\n    \"vendor\": \"ACME Corporation\",\n    \"total\": 450.00,\n    \"approved\": true,\n    \"reason\": \"Auto-approved: $450.00, 92.0% confidence\",\n    \"checks\": {\n        \"amount_within_threshold\": true,\n        \"confidence_sufficient\": true,\n        \"is_invoice\": true,\n        \"is_not_receipt\": true,\n        \"bill_to_authorized\": true\n    },\n    \"confidence\": 0.92\n}"
				}
			]
		}
	],
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		}
	],
	"variable": [
		{
			"key": "base_url",
			"value": "http://localhost:8000",
			"type": "string"
		},
		{
			"key": "apim_url",
			"value": "https://your-apim.azure-api.net/invoices",
			"type": "string",
			"disabled": true
		},
		{
			"key": "apim_subscription_key",
			"value": "your-subscription-key-here",
			"type": "string",
			"disabled": true
		}
	]
}